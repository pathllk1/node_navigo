═══════════════════════════════════════════════════════════════════════════════
  MIGRATION ARCHITECTURE: node_ejs → Current Navigo App
═══════════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────────┐
│                          CURRENT APPLICATION                                 │
│                     (Navigo SPA + Express + SQLite)                         │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                              FRONTEND LAYER                                  │
│                         (Navigo SPA - Vanilla JS)                           │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   EXISTING   │  │   EXISTING   │  │   EXISTING   │  │   EXISTING   │  │
│  │    PAGES     │  │    PAGES     │  │    PAGES     │  │    PAGES     │  │
│  ├──────────────┤  ├──────────────┤  ├──────────────┤  ├──────────────┤  │
│  │ Home         │  │ AuthPage     │  │ AdminPanel   │  │ MasterRoll   │  │
│  │ About        │  │ Login/Signup │  │ User Mgmt    │  │ Employee Mgmt│  │
│  │ Contact      │  │              │  │ Firm Mgmt    │  │              │  │
│  │ Services     │  │              │  │              │  │              │  │
│  └──────────────┘  └──────────────┘  └──────────────┘  └──────────────┘  │
│                                                                              │
│  ┌──────────────┐                                                           │
│  │   EXISTING   │                                                           │
│  │    PAGES     │                                                           │
│  ├──────────────┤                                                           │
│  │ Wages        │                                                           │
│  │ Dashboard    │                                                           │
│  │ Create/Manage│                                                           │
│  └──────────────┘                                                           │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐   │
│  │                      NEW PAGES TO ADD                               │   │
│  ├────────────────────────────────────────────────────────────────────┤   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │   │
│  │  │  INVENTORY   │  │   LEDGER     │  │  VOUCHERS    │            │   │
│  │  ├──────────────┤  ├──────────────┤  ├──────────────┤            │   │
│  │  │ Dashboard    │  │ Dashboard    │  │ Dashboard    │            │   │
│  │  │ Sales Bills  │  │ Accounts     │  │ Payment      │            │   │
│  │  │ Purchase     │  │ Trial Balance│  │ Receipt      │            │   │
│  │  │ Stocks       │  │ Gen. Ledger  │  │ Journal      │            │   │
│  │  │ Movements    │  │ Reports      │  │              │            │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘            │   │
│  │                                                                      │   │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐            │   │
│  │  │   PARTIES    │  │   BANKING    │  │   REPORTS    │            │   │
│  │  ├──────────────┤  ├──────────────┤  ├──────────────┤            │   │
│  │  │ Dashboard    │  │ Dashboard    │  │ Dashboard    │            │   │
│  │  │ Party List   │  │ Accounts     │  │ Sales Report │            │   │
│  │  │ Party Ledger │  │ Transactions │  │ Purchase Rep │            │   │
│  │  │ GST Mgmt     │  │ Reconcile    │  │ Stock Report │            │   │
│  │  └──────────────┘  └──────────────┘  └──────────────┘            │   │
│  │                                                                      │   │
│  └────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
│  ┌────────────────────────────────────────────────────────────────────┐   │
│  │                    REUSABLE COMPONENTS                              │   │
│  ├────────────────────────────────────────────────────────────────────┤   │
│  │  DataTable │ Modal │ Toast │ DatePicker │ FormInputs │ Dropdown   │   │
│  │  ItemSelector │ AccountSelector │ PartySelector │ BillForm        │   │
│  └────────────────────────────────────────────────────────────────────┘   │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ HTTP/JSON
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              BACKEND LAYER                                   │
│                          (Express.js + SQLite)                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        EXISTING ROUTES                                │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │  /auth/*          - Authentication (login, signup, refresh)          │  │
│  │  /admin/*         - Admin panel (users, firms, logs)                 │  │
│  │  /api/master-rolls/* - Employee management                           │  │
│  │  /api/wages/*     - Wages management                                 │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                        NEW ROUTES TO ADD                              │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │                                                                        │  │
│  │  /api/inventory/*                                                     │  │
│  │    ├─ /sales/bills (GET, POST, PUT, DELETE)                          │  │
│  │    ├─ /purchase/bills (GET, POST, PUT, DELETE)                       │  │
│  │    ├─ /stocks (GET, POST, PUT, DELETE)                               │  │
│  │    ├─ /stock-movements (GET, POST)                                   │  │
│  │    └─ /bills/:id/pdf (GET)                                           │  │
│  │                                                                        │  │
│  │  /api/ledger/*                                                        │  │
│  │    ├─ /accounts (GET, POST, PUT, DELETE)                             │  │
│  │    ├─ /entries (GET, POST)                                           │  │
│  │    ├─ /trial-balance (GET)                                           │  │
│  │    ├─ /general-ledger (GET)                                          │  │
│  │    └─ /account-statement/:id (GET)                                   │  │
│  │                                                                        │  │
│  │  /api/vouchers/*                                                      │  │
│  │    ├─ /payment (POST)                                                │  │
│  │    ├─ /receipt (POST)                                                │  │
│  │    ├─ /journal (POST)                                                │  │
│  │    ├─ / (GET - list all)                                             │  │
│  │    └─ /:id (GET, PUT, DELETE)                                        │  │
│  │                                                                        │  │
│  │  /api/parties/*                                                       │  │
│  │    ├─ / (GET, POST)                                                  │  │
│  │    ├─ /:id (GET, PUT, DELETE)                                        │  │
│  │    ├─ /:id/ledger (GET)                                              │  │
│  │    └─ /:id/gst (POST, PUT, DELETE)                                   │  │
│  │                                                                        │  │
│  │  /api/banks/*                                                         │  │
│  │    ├─ /accounts (GET, POST, PUT, DELETE)                             │  │
│  │    ├─ /transactions (GET, POST)                                      │  │
│  │    └─ /reconciliation (GET, POST)                                    │  │
│  │                                                                        │  │
│  │  /api/reports/*                                                       │  │
│  │    ├─ /sales-summary (GET)                                           │  │
│  │    ├─ /purchase-summary (GET)                                        │  │
│  │    ├─ /stock-summary (GET)                                           │  │
│  │    ├─ /gst-summary (GET)                                             │  │
│  │    ├─ /profit-loss (GET)                                             │  │
│  │    └─ /balance-sheet (GET)                                           │  │
│  │                                                                        │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                          MIDDLEWARE                                   │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │  authenticateJWT  │  verifyFirmAccess  │  sanitizer  │  CSP         │  │
│  │  requestLogger    │  errorHandler      │  validation │              │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                          UTILITIES                                    │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │  billNumberGenerator  │  gstCalculator  │  pdfGenerator             │  │
│  │  ledgerHelper         │  dateFormatter  │  numberFormatter          │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
                                      │
                                      │ SQL
                                      ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                            DATABASE LAYER                                    │
│                              (SQLite)                                        │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                      EXISTING TABLES                                  │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │  users  │  firms  │  master_rolls  │  wages  │  payments            │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                      NEW TABLES TO ADD                                │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │                                                                        │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │  │
│  │  │ bill_sequences  │  │ firm_settings   │  │ party_gsts      │     │  │
│  │  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤     │  │
│  │  │ firm_id         │  │ firm_id         │  │ party_id        │     │  │
│  │  │ financial_year  │  │ setting_key     │  │ gst_number      │     │  │
│  │  │ last_sequence   │  │ setting_value   │  │ state           │     │  │
│  │  │ voucher_type    │  │ description     │  │ address         │     │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │  │
│  │                                                                        │  │
│  │  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐     │  │
│  │  │ bank_accounts   │  │ vouchers        │  │ settings        │     │  │
│  │  ├─────────────────┤  ├─────────────────┤  ├─────────────────┤     │  │
│  │  │ firm_id         │  │ voucher_no      │  │ setting_key     │     │  │
│  │  │ bank_name       │  │ voucher_type    │  │ setting_value   │     │  │
│  │  │ account_number  │  │ voucher_date    │  │ description     │     │  │
│  │  │ current_balance │  │ party_id        │  │                 │     │  │
│  │  └─────────────────┘  └─────────────────┘  └─────────────────┘     │  │
│  │                                                                        │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
│  ┌──────────────────────────────────────────────────────────────────────┐  │
│  │                   ENHANCED EXISTING TABLES                            │  │
│  ├──────────────────────────────────────────────────────────────────────┤  │
│  │                                                                        │  │
│  │  bills (add: voucher fields, GST JSON, reverse charge)               │  │
│  │  parties (add: multiple GST support, state codes)                    │  │
│  │  stocks (add: batch tracking JSON)                                   │  │
│  │  ledger (add: voucher integration)                                   │  │
│  │  firms (add: GST, PAN, bank details)                                 │  │
│  │                                                                        │  │
│  └──────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

═══════════════════════════════════════════════════════════════════════════════
                            DATA FLOW EXAMPLE
═══════════════════════════════════════════════════════════════════════════════

CREATE SALES BILL FLOW:
─────────────────────────

1. User fills bill form in SalesBills.js page
2. Click "Save Bill" button
3. Frontend validates data
4. POST /api/inventory/sales/bills with bill data
5. Backend: authenticateJWT middleware
6. Backend: verifyFirmAccess middleware
7. Backend: sales.controller.js processes request
8. Backend: billNumberGenerator.js generates bill number
9. Backend: gstCalculator.js calculates GST
10. Backend: Insert into bills table
11. Backend: Insert into stock_reg table (line items)
12. Backend: Update stocks table (reduce quantity)
13. Backend: ledgerHelper.js creates ledger entries
14. Backend: Insert into ledger table (auto-posting)
15. Backend: Return success response with bill_id
16. Frontend: Show success toast
17. Frontend: Navigate to bill view page
18. User can generate PDF from bill view

═══════════════════════════════════════════════════════════════════════════════
                          SECURITY & COMPLIANCE
═══════════════════════════════════════════════════════════════════════════════

✅ JWT Authentication (access + refresh tokens)
✅ Firm-based Authorization (multi-tenant)
✅ CSP Compliance (no inline scripts/styles)
✅ XSS Prevention (input sanitization)
✅ SQL Injection Prevention (parameterized queries)
✅ CSRF Protection (token-based)
✅ Audit Logging (request logs)
✅ Role-based Access Control (admin, manager, user)

═══════════════════════════════════════════════════════════════════════════════
                          PERFORMANCE OPTIMIZATION
═══════════════════════════════════════════════════════════════════════════════

✅ Database Indexing (firm_id, dates, bill numbers)
✅ Pagination (limit/offset for large datasets)
✅ Lazy Loading (load data on demand)
✅ Caching (frequently accessed data)
✅ Efficient Queries (JOIN optimization)
✅ Connection Pooling (database connections)
✅ Compression (gzip responses)
✅ CDN (static assets)

═══════════════════════════════════════════════════════════════════════════════
